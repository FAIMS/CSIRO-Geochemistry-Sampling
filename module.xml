<!--@POSTPROC: ./postproc.sh-->

<!--TODO: -->
<!--upon testing the CSIRO-xxx-2017-09-27 on dev, I have found the following things. Can you fix it today, please?-->
  <!--Limit Prefix 1 to max 6 characters-->
  <!--Start Tab / Scan Label button move on the top of the Tab, above Author-->
  <!--All Sample TabGroups / Timestamp rename to Date, since it is not Timestamp anymore, but date TODO: Test-->
  <!--the Search does not show Soil (crust) records, please add it-->
  <!--Water Sample / Hole Angle / Vertical - the estimated angles should be populated as 90 (per old regression test) https://faimsproject.atlassian.net/wiki/spaces/CS17/pages/80553170/CSIRO+Geochemical+Sampling+2017+Regression+Tests-->
  <!--I see some behaviour of the Sample Prefix 2, which is not consistent for all samples. I think I understand what you have done here, but it's happening just for 2/5 samples, which can be very confusing for the user. I would suggest to make it all consistent (to fill in the basic prefix representation for each type (W-, R, V, S/CR), but still make it writable, so they can fill in the rest)-->
<!--Lower priority:-->
  <!--Uncomment one line that enables the bluetooth com in the module-->
  <!--MapTab - how is Soil Crust displayed on the map? as a black dot similarly as Soil? Can you make Soil Crust dark grey, so we distinguish them.-->
<!--once you recompile, upload the module also with images and logo, so I can test everything works properly-->

<module>

<rels>
  <RelationshipElement name="Water Sample pH" type="bidirectional">
    <description>Implements a 1:N relationship between Water Samples and pH</description>
  </RelationshipElement>
  <RelationshipElement name="Water Sample Eh" type="bidirectional">
    <description>Implements a 1:N relationship between Water Samples and Eh</description>
  </RelationshipElement>
</rels>

<Logo f="nodata">
  <Logo_Tab f="noscroll">
    <CSIRO_Logo f="nolabel" t="webview">
      <markdown>
![](files/data/CSIRO_Grad_RGB_hr.jpg)

This module was generated by the FAIMS Team for CSIRO, Nathan Reid and Jens Klump and is distributed under a GPL v3 license.
      </markdown>
    </CSIRO_Logo>
    <Login l="User"/>
  </Logo_Tab>
</Logo>

<User f="nodata">
  <User f="noscroll">
    <Users t="list" f="user" l="Project"/>
  </User>
</User>

<Project f="nodata">
  <Start>
    <author f="readonly"/>
    <Station_Deposit f="persist">
      Station/Deposit
    </Station_Deposit>
    <Project f="persist"/>
    <Area f="persist"/>
    <Sample_Type>
      <opts>
        <opt>Water Sample</opt>
        <opt>Vegetation Sample</opt>
        <opt>Soil Sample</opt>
        <opt>Soil (Crust) Sample</opt>
        <opt>Rock Sample</opt>
      </opts>
    </Sample_Type>
    <cols>
      <Sample_Prefix_1 f="persist"/>
      <Sample_Prefix_2 f="persist"/>
      <Sample_Starting_ID b="decimal">
        Next Sample ID
        <!--This is used as the autonumbering field, with the help of
             autogenerated code-->
      </Sample_Starting_ID>
    </cols>
    <Create_New_Sample t="button"/>
    <Scan_Label t="button"/>
    <GPS_Status t="gpsdiag"/>
    <Check_for_Duplicates t="button"/>
    <Duplicate_ID_List t="list" c="fixedheightfive"/>
  </Start>
  <Sample_ID_Ranges>
    <Minimum_Sample_ID b="decimal" f="persist"/>
    <Maximum_Sample_ID b="decimal" f="persist"/>
  </Sample_ID_Ranges>
  <search>
    <!--TODO: And Brian said something about using 2017 Bird Search-->
  </search>
  <Map f="noscroll">
    <Map f="nolabel" t="map"/>
    <Create_Shape l="Shape"/>
  </Map>
  <Vars f="hidden nowire">
    <!--Generates functions to create new arch ents, which will call in the
         logic-->
    <New_Water_Sample l="Water_Sample"/>
    <New_Vegetation_Sample l="Vegetation_Sample"/>
    <New_Soil_Sample  l="Soil_Sample"/>
    <New_Soil_Crust_Sample  l="Soil_Crust_Sample"/>
    <New_Rock_Sample  l="Rock_Sample"/>
  </Vars>
</Project>

<Water_Sample>
  <fmt>{{Sample_Prefix_1}}-{{Sample_Prefix_2}}-{{Sample_ID}}{{Suffix if $0 then "-$0"}} - {{Timestamp}}</fmt>
  <Basic_Info>
    <cols>
      <Sample_Prefix_1 f="readonly" i="Project/Start/Sample_Prefix_1"/>
      <Sample_Prefix_2 f="readonly" i="Project/Start/Sample_Prefix_2"/>
      <Sample_ID f="readonly"/>
    </cols>
    <Suffix>
      <opts>
        <opt>AK</opt>
        <opt>AN</opt>
        <opt>CB</opt>
        <opt>CT</opt>
      </opts>
    </Suffix>
    <Print_Label t="button"/>
    <cols>
      <Timestamp_Field b="date">Date</Timestamp_Field>
      <author/>
    </cols>
    <Station_Deposit f="readonly" i="Project/Start/Station_Deposit">
      Station/Deposit
    </Station_Deposit>
    <Project f="readonly" i="Project/Start/Project"/>
    <Area f="readonly" i="Project/Start/Area"/>
    <Site_Name/>
    <!--@SOURCE: fields/std-dynamic.xml-->
    <!--@SOURCE: fields/std-gis.xml-->
    <Water_Table/>
    <Sample_Depth>
      Sample Depth (m)
    </Sample_Depth>
    <Bottom_Of_Hole/>
    <Samples_Collected t="checkbox">
      <opts>
        <opt>Cations</opt>
        <opt>Anions</opt>
        <opt>Alkalinity</opt>
        <opt>Carbon (1L)</opt>
      </opts>
    </Samples_Collected>
    <!--@SOURCE: fields/std-bottom.xml-->
  </Basic_Info>
  <Codes>
    <Hole_Type>
      <opts>
        <opt>Still Bore (Bailed)</opt>
        <opt>Still Well (Bailed)</opt>
        <opt>Flowing Bore</opt>
        <opt>Flowing Well</opt>
        <opt>Other</opt>
      </opts>
    </Hole_Type>
    <Hole_Lining>
      <opts>
        <opt>Metal</opt>
        <opt>Rusty</opt>
        <opt>Poly pipe/plastic</opt>
        <opt>Cement</opt>
        <opt>Wood</opt>
        <opt>Dirt</opt>
        <opt>Other</opt>
      </opts>
    </Hole_Lining>
    <Hole_Open_Closed t="radio">
      Hole Open/Closed
      <opts>
        <opt>No Observation</opt>
        <opt>Open/uncovered</opt>
        <opt>Closed/covered</opt>
      </opts>
    </Hole_Open_Closed>
    <Pipes_In_Hole>
      <opts>
        <opt>Metal Pipes</opt>
        <opt>Poly Pipes</opt>
        <opt>Fibreglass Pipes</opt>
        <opt>No pipes/clear</opt>
        <opt>Other</opt>
      </opts>
    </Pipes_In_Hole>
    <cols>
      <Hole_Angle>
        <opts>
          <opt>Vertical</opt>
          <opt>Angled</opt>
          <opt>Other</opt>
        </opts>
      </Hole_Angle>
      <Estimated_Angle b="decimal"/>
    </cols>
    <Outflow_Present t="radio">
      <!--@SOURCE: vocabs/boolean.xml-->
    </Outflow_Present>
    <Sampling_Issues>
      <opts>
        <opt>Sampled from outflow of tank</opt>
        <opt>Bailed from a flowing windmill (access issues, no wind etc.)</opt>
        <opt>Pumped</opt>
        <opt>Other</opt>
      </opts>
    </Sampling_Issues>
  </Codes>
  <pH_Eh>
    pH/Eh
    <cols>
      <Temperature  f="notnull"/>
      <Conductivity f="notnull"/>
    </cols>
    <cols>
      <col>
        <Preferred_pH f="readonly"/>
        <Preferred_pH_Time f="nodata readonly"/>
        <addNewpHText t="webview" f="nolabel">
          <markdown>pH</markdown>
        </addNewpHText>
      </col>
      <col>
        <Preferred_Eh f="readonly"/>
        <Preferred_Eh_Time f="nodata readonly"/>
        <addNewEhText t="webview" f="nolabel">
          <markdown>Eh (mV)</markdown>
        </addNewEhText>
      </col>
    </cols>
  </pH_Eh>
  <!--@SOURCE: tabs/child-photologs.xml-->
  <Hidden f="hidden nowire">
    <Preferred_pH_Time/>
    <Preferred_Eh_Time/>
  </Hidden>
  <!--@SOURCE: tabs/vars.xml-->
</Water_Sample>

<Vegetation_Sample>
  <fmt>{{Sample_Prefix_1}}-{{Sample_Prefix_2}}-{{Sample_ID}} - {{Timestamp}}</fmt>
  <Basic_Info>
    <!--@SOURCE: fields/std-meta.xml-->
    <!--@SOURCE: fields/std-dynamic.xml-->
    <Vegetation_Species/>
    <!--@SOURCE: fields/std-gis.xml-->
    <cols>
      <Vegetation_Height b="decimal"/>
      <Vegetation_Width  b="decimal"/>
    </cols>
    <Soil_Description t="checkbox">
      <!--@SOURCE: vocabs/soil-adjective.xml-->
    </Soil_Description>
    <Landform_Description/>
    <!--@SOURCE: fields/std-bottom.xml-->
  </Basic_Info>
  <!--@SOURCE: tabs/child-photologs.xml-->
  <!--@SOURCE: tabs/vars.xml-->
</Vegetation_Sample>

<Soil_Sample>
  <fmt>{{Sample_Prefix_1}}-{{Sample_Prefix_2}}-{{Sample_ID}}{{Suffix if $0 then "-$0"}} - {{Timestamp}}</fmt>
  <Basic_Info>
    <cols>
      <Sample_Prefix_1 f="readonly" i="Project/Start/Sample_Prefix_1"/>
      <Sample_Prefix_2 f="readonly" i="Project/Start/Sample_Prefix_2"/>
      <Sample_ID f="readonly"/>
    </cols>
    <Suffix>
      <opts>
        <opt>A</opt>
        <opt>B</opt>
      </opts>
    </Suffix>
    <Print_Label t="button"/>
    <cols>
      <Timestamp_Field b="date">Date</Timestamp_Field>
      <author/>
    </cols>
    <Station_Deposit f="readonly" i="Project/Start/Station_Deposit">
      Station/Deposit
    </Station_Deposit>
    <Project f="readonly" i="Project/Start/Project"/>
    <Area f="readonly" i="Project/Start/Area"/>
    <!--@SOURCE: fields/std-dynamic.xml-->
    <!--@SOURCE: fields/std-gis.xml-->
    <Depth b="decimal">
      Depth (m)
    </Depth>
    <Colour/>
    <Lag t="radio">
      <!--@SOURCE: vocabs/boolean.xml-->
    </Lag>
    <Soil_Texture t="checkbox">
      <!--@SOURCE: vocabs/soil-adjective.xml-->
    </Soil_Texture>
    <Geology>
      <!--@SOURCE: vocabs/ology.xml-->
    </Geology>
    <Drainage t="radio">
      <!--@SOURCE: vocabs/boolean.xml-->
    </Drainage>
    <Contamination t="radio">
      <!--@SOURCE: vocabs/boolean.xml-->
    </Contamination>
    <Regolith_Type>
      <opts>
        <opt>Transported Regolith
          <opt>Alluvial sediments
            <opt>Channel deposits</opt>
            <opt>Overbank deposits</opt>
          </opt>
          <opt>Aeolian sediments
            <opt>Aeolian sand</opt>
            <opt>Loess</opt>
            <opt>Parna</opt>
          </opt>
          <opt>Colluvial sediments
            <opt>Mass movement</opt>
            <opt>Sheet flow deposit</opt>
            <opt>Fanglomerate</opt>
          </opt>
          <opt>Evaporite
            <opt>Halite</opt>
            <opt>Gypsum</opt>
          </opt>
          <opt>Lacustrine sediments</opt>
          <opt>Glacial sediments</opt>
          <opt>Volcanic sediments
            <opt>Tephra</opt>
          </opt>
          <opt>Fill</opt>
          <opt>Coastal sediments
            <opt>Beach sediments</opt>
            <opt>Estuarine sediments</opt>
            <opt>Coral</opt>
            <opt>Marine sediments</opt>
          </opt>
        </opt>
        <opt>In-Situ Regolith
          <opt>Weathered bedrock</opt>
          <opt>Residual material</opt>
          <opt>Saprolite
            <opt>Completely weathered bedrock</opt>
            <opt>Very highly weathered bedrock</opt>
            <opt>Highly weathered bedrock</opt>
            <opt>Moderately weathered bedrock</opt>
            <opt>Slightly weathered bedrock</opt>
          </opt>
        </opt>
        <opt>Other</opt>
      </opts>
    </Regolith_Type>
    <!--@SOURCE: vocabs/landform.xml-->
    <Vegetation/>
    <!--@SOURCE: fields/std-bottom.xml-->
  </Basic_Info>
  <!--@SOURCE: tabs/child-photologs.xml-->
  <!--@SOURCE: tabs/vars.xml-->
</Soil_Sample>

<Soil_Crust_Sample>
  Soil (Crust) Sample
  <fmt>{{Sample_Prefix_1}}-{{Sample_Prefix_2}}-{{Sample_ID}}{{Suffix if $0 then "-$0"}} - {{Timestamp}}</fmt>
  <Basic_Info>
    <cols>
      <Sample_Prefix_1 f="readonly" i="Project/Start/Sample_Prefix_1"/>
      <Sample_Prefix_2 f="readonly" i="Project/Start/Sample_Prefix_2"/>
      <Sample_ID f="readonly"/>
    </cols>
    <Suffix>
      <opts>
        <opt>A</opt>
        <opt>B</opt>
      </opts>
    </Suffix>
    <Print_Label t="button"/>
    <cols>
      <Timestamp_Field b="date">Timestamp</Timestamp_Field>
      <author/>
    </cols>
    <Station_Deposit f="readonly" i="Project/Start/Station_Deposit">
      Station/Deposit
    </Station_Deposit>
    <Project f="readonly" i="Project/Start/Project"/>
    <Area f="readonly" i="Project/Start/Area"/>
    <!--@SOURCE: fields/std-dynamic.xml-->
    <!--@SOURCE: fields/std-gis.xml-->
    <Depth b="decimal">
      Depth (m)
    </Depth>
    <Colour/>
    <Lag t="radio">
      <!--@SOURCE: vocabs/boolean.xml-->
    </Lag>
    <Soil_Texture t="checkbox">
      <!--@SOURCE: vocabs/soil-adjective.xml-->
    </Soil_Texture>
    <Geology>
      <!--@SOURCE: vocabs/ology.xml-->
    </Geology>
    <Drainage t="radio">
      <!--@SOURCE: vocabs/boolean.xml-->
    </Drainage>
    <Contamination t="radio">
      <!--@SOURCE: vocabs/boolean.xml-->
    </Contamination>
    <Regolith_Type>
      <opts>
        <opt>Transported Regolith
          <opt>Alluvial sediments
            <opt>Channel deposits</opt>
            <opt>Overbank deposits</opt>
          </opt>
          <opt>Aeolian sediments
            <opt>Aeolian sand</opt>
            <opt>Loess</opt>
            <opt>Parna</opt>
          </opt>
          <opt>Colluvial sediments
            <opt>Mass movement</opt>
            <opt>Sheet flow deposit</opt>
            <opt>Fanglomerate</opt>
          </opt>
          <opt>Evaporite
            <opt>Halite</opt>
            <opt>Gypsum</opt>
          </opt>
          <opt>Lacustrine sediments</opt>
          <opt>Glacial sediments</opt>
          <opt>Volcanic sediments
            <opt>Tephra</opt>
          </opt>
          <opt>Fill</opt>
          <opt>Coastal sediments
            <opt>Beach sediments</opt>
            <opt>Estuarine sediments</opt>
            <opt>Coral</opt>
            <opt>Marine sediments</opt>
          </opt>
        </opt>
        <opt>In-Situ Regolith
          <opt>Weathered bedrock</opt>
          <opt>Residual material</opt>
          <opt>Saprolite
            <opt>Completely weathered bedrock</opt>
            <opt>Very highly weathered bedrock</opt>
            <opt>Highly weathered bedrock</opt>
            <opt>Moderately weathered bedrock</opt>
            <opt>Slightly weathered bedrock</opt>
          </opt>
        </opt>
        <opt>Other</opt>
      </opts>
    </Regolith_Type>
    <!--@SOURCE: vocabs/landform.xml-->
    <Vegetation/>
    <!--@SOURCE: fields/std-bottom.xml-->
  </Basic_Info>
  <!--@SOURCE: tabs/child-photologs.xml-->
  <!--@SOURCE: tabs/vars.xml-->
</Soil_Crust_Sample>

<Rock_Sample>
  <fmt>{{Sample_Prefix_1}}-{{Sample_Prefix_2}}-{{Sample_ID}} - {{Timestamp}}</fmt>
  <Basic_Info>
    <!--@SOURCE: fields/std-meta.xml-->
    <Location_Number/>
    <!--@SOURCE: vocabs/observation-type.xml-->
    <Core_ID/>
    <!--@SOURCE: fields/std-gis.xml-->
  </Basic_Info>
  <Measurements>
    <cols>
      <col>
        <Bedding_Strike   b="decimal"/>
        <Cleavage_Strike  b="decimal"/>
        <Foliation_Strike b="decimal"/>
        <Veins_1_Strike   b="decimal"/>
        <Veins_2_Strike   b="decimal"/>
      </col>
      <col>
        <Bedding_Dip   b="decimal"/>
        <Cleavage_Dip  b="decimal"/>
        <Foliation_Dip b="decimal"/>
        <Veins_1_Dip   b="decimal"/>
        <Veins_2_Dip   b="decimal"/>
      </col>
    </cols>
    <Other_Structural_Measurements/>
    <cols>
      <col>
        <Fold_Axis_Plunge            b="decimal"/>
        <Mineral_Lineation_Plunge    b="decimal"/>
        <Stretching_Lineation_Plunge b="decimal"/>
      </col>
      <col>
        <Fold_Axis_Azimuth            b="decimal"/>
        <Mineral_Lineation_Azimuth    b="decimal"/>
        <Stretching_Lineation_Azimuth b="decimal"/>
      </col>
    </cols>
    <Other_Lineation/>
  </Measurements>
  <Lithological_Info>
    <Lithology>
      <!--@SOURCE: vocabs/ology.xml-->
    </Lithology>
    <Inclusion_Size>
      <opts>
        <opt>Fine</opt>
        <opt>Medium</opt>
        <opt>Coarse</opt>
        <opt>Other</opt>
      </opts>
    </Inclusion_Size>
    <Grain_Size>
      <opts>
        <opt>Fine</opt>
        <opt>Medium</opt>
        <opt>Coarse</opt>
        <opt>Other</opt>
      </opts>
    </Grain_Size>
    <Sorting>
      <opts>
        <opt>Poor</opt>
        <opt>Moderate</opt>
        <opt>Well Sorted</opt>
        <opt>Other</opt>
      </opts>
    </Sorting>
    <Other_Lithological_Descriptors/>
    <Stratigraphic_Unit/>
    <Large-Scale_Structure/>
    <Alteration/>
    <Veining/>
    <!--@SOURCE: fields/std-bottom.xml-->
  </Lithological_Info>
  <!--@SOURCE: tabs/child-photologs.xml-->
  <!--@SOURCE: tabs/vars.xml-->
</Rock_Sample>

<pH>
  <fmt>{{pH}} {{timestamp}}</fmt>
  <pH>
    <pH/>
    <Time/>
    <Preferred/>
  </pH>
</pH>

<Eh>
  <fmt>{{Eh}} {{timestamp}}</fmt>
  <Eh>
    <Eh/>
    <Time/>
    <Preferred/>
  </Eh>
</Eh>

<Photolog>
  <fmt>{{Photo_ID}}</fmt>
  <Photolog>
    <Photo_ID f="notnull"/>
    <timestamp/>
    <Photo_Note/>
  </Photolog>
</Photolog>

<Shape>
  <fmt>{{Label}}</fmt>
  <Shape_Note>
    <Label/>
    <Note/>
  </Shape_Note>
</Shape>

<logic><![CDATA[
<!--@SOURCE: logic/shared.bsh-->
<!--@SOURCE: logic/map.bsh-->
<!--@SOURCE: logic/shape.bsh-->
<!--@SOURCE: logic/custom-search.bsh-->
<!--@SOURCE: logic/duplicate-checking.bsh-->
<!--@SOURCE: logic/create-new-sample-button.bsh-->
<!--@SOURCE: logic/autonumbering.bsh-->
<!--@SOURCE: logic/project-author.bsh-->
<!--@SOURCE: logic/timestamps.bsh-->
<!--@SOURCE: logic/dynamic-ui.bsh-->
<!--@SOURCE: logic/dynamic-ui-ph-eh.bsh-->
<!--@SOURCE: logic/take-from-gps.bsh-->
<!--@SOURCE: logic/qr-codes.bsh-->
<!--@SOURCE: logic/bluetooth.bsh-->
<!--@SOURCE: logic/prefix-2-setter.bsh-->
<!--@SOURCE: logic/angles.bsh-->
<!--@SOURCE: logic/duplication.bsh-->
<!--@SOURCE: logic/update-and-rescan-label.bsh-->
]]></logic>

</module>
